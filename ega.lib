EGAWWSETUP	PROC
	PUSH	AX
	PUSH	BX
	PUSH	CX
	PUSH	DX
	MOV	AX,WORD PTR CS:[VTBL+4]
	XOR	BH,BH
	MOV	BL,BYTE PTR ES:[DI+8]
	XOR	DX,DX
	DIV	BX
	MOV	WORD PTR CS:[YMAX],AX
	MOV	AX,WORD PTR CS:[VTBL+6]
	MOV	CL,3
	SHR	AX,CL
	MOV	WORD PTR CS:[XMAX],AX
	POP	DX
	POP	CX
	POP	BX
	POP	AX
	RET
ENDP
WW	PROC
	;IN
	;DS:SI - 
	;ES:DI -  
	;OUT
	;CX - NUMB OF OUTPUT SYMBOLS
	JC	WW2
	CALL	EGAWWSETUP
WW2:
	PUSH	AX
WW1:
	LODSB
	OR	AL,AL
	JE	WWE
	CALL	WS
	JMP	SHORT	WW1
WWE:
	POP	AX
	RET
ENDP
WSPC	PROC
	;IN
	;CX - NUM OF SPACES
	;ES:DI -  
	JC	WSPC1
	CALL	EGAWWSETUP
WSPC1:
	PUSH	AX
	PUSH	CX
	MOV	AL,' '
WSPC1:
	CALL	WS
	LOOP	WSPC1
	POP	CX
	POP	AX
	RET
ENDP
WWIN	PROC

ENDP
WFST	PROC
	;IN
	;CX - LEN STRING
	;ES:DI -  
	PUSH	AX
	PUSH	CX
	MOV	AL,''
	CALL	WS
	MOV	AL,' '
	CALL	WS
	CALL	WS
	SUB	CX,6
	MOV	AL,''
WFST1:
	CALL	WS
	LOOP	WFST1
	MOV	AL,' '
	CALL	WS
	CALL	WS
	MOV	AL,''
	CALL	WS
	POP	CX
	POP	AX
	RET
ENDP
WNXT	PROC
	;IN
	;CX - LEN STRING
	;ES:DI -  
	PUSH	AX
	PUSH	CX
	MOV	AL,''
	CALL	WS
	MOV	AL,' '
	CALL	WS
	CALL	WS
	SUB	CX,6
	MOV	AL,''
WNXT1:
	CALL	WS
	LOOP	WNXT1
	MOV	AL,' '
	CALL	WS
	CALL	WS
	MOV	AL,''
	CALL	WS
	POP	CX
	POP	AX
	RET
ENDP
WLST	PROC
	;IN
	;CX - LEN STRING
	;ES:DI -  
	PUSH	AX
	PUSH	CX
	MOV	AL,''
	CALL	WS
	MOV	AL,' '
	CALL	WS
	CALL	WS
	SUB	CX,6
	MOV	AL,''
WLST1:
	CALL	WS
	LOOP	WLST1
	MOV	AL,' '
	CALL	WS
	CALL	WS
	MOV	AL,''
	CALL	WS
	POP	CX
	POP	AX
	RET
ENDP
WS	PROC
	;AL - SYMBOL
	PUSH	BX
	PUSH	CX
	PUSH	DX
	PUSH	AX
	MOV	AX,WORD PTR CS:[Y]
	XOR	BH,BH
	MOV	BL,BYTE PTR ES:[DI+8]
	MUL	BX
	MOV	WORD PTR ES:[DI+4],AX
	MOV	AX,WORD PTR CS:[X]
	MOV	CL,3
	SHL	AX,CL
	MOV	WORD PTR ES:[DI+6],AX
	POP	AX
	MOV	BX,DI
	PUSH	ES
	POP	DS
	CALL	EGAWS
	MOV	AX,WORD PTR CS:[X]
	INC	AX
	MOV	WORD PTR CS:[X],AX
	CMP	AX,WORD PTR CS:[XMAX]
	JNE	WS3
	MOV	WORD PTR CS:[X],0
	MOV	AX,WORD PTR CS:[Y]
	INC	AX
	CMP	AX,WORD PTR CS:[YMAX]
	JNE	WS2
	XOR	AX,AX
WS2:
	MOV	WORD PTR CS:[Y],AX
WS3:
	POP	DX
	POP	CX
	POP	BX
	RET
X	DW	0
Y	DW	0
XMAX	DW	0
YMAX	DW	0
ENDP
;FOR I8086
EGAWS	PROC	;WRITE_SYMBOL
	;IN
	;AL - 
	;DS:BX -   (16 BYTES)
	;+0 DWORD -   
	;+4 WORD  - Y  
	;+6 WORD  - X  
	;+8 WORD  - YMAX
	;+A WORD  - XMAX
	;+C BYTE  -  
	;+D BYTE  -  
	;+E BYTE  -  

	PUSHF
	PUSH	AX
	PUSH	BX
	PUSH	CX
	PUSH	DX
	PUSH	SI
	PUSH	DI
	PUSH	BP
	PUSH	DS
	PUSH	ES
	PUSH	AX
	MOV	AX,DS:[BX+4]
	MOV	DX,WORD PTR CS:[VTBL+6];640
	SHR	DX,3
	MOV	BP,DX
	DEC	BP
	MUL	DX
	MOV	CH,DH
	MOV	DI,DS:[BX+6]
	SHR	DI,3
	ADD	AX,DI
	LES	DI,DWORD PTR CS:[VTBL]
	ADD	DI,AX
	POP	AX
	MOV	CL,DS:[BX+8]
	MUL	CX
	MOV	DX,WORD PTR DS:[BX+9]
	LDS	SI,DWORD PTR DS:[BX]
	ADD	SI,AX
;	MOV	DS,WORD PTR DS:[BX+2]
	MOV	BX,DX
	CLD
	MOV	DX,3CEH
	MOV	AX,205H
	OUT	DX,AX
	MOV	AX,3
	OUT	DX,AX
	MOV	AL,4
	OUT	DX,AX
EGA_WS1:
	MOV	AX,0FF08H
	OUT	DX,AX
	XCHG	AH,AL
	MOV	AL,BH
	MOV	ES:[DI],AL
	MOV	AL,ES:[DI]	;CMPSB?
	LODSB
	XCHG	AH,AL
	OUT	DX,AX
	MOV	AL,BL
	STOSB
	ADD	DI,BP
	LOOP	EGA_WS1
	POP	ES
	POP	DS
	POP	BP
	POP	DI
	POP	SI
	POP	DX
	POP	CX
	POP	BX
	POP	AX
	POPF
	RET
ENDP
VTBL	DD	0A0000000H  ;  +  
	DW	350	;YMAX
	DW	640	;XMAX
	DB	4	;-  
	DB	0
	DW	0,0,0
