;FOR	I80286
EGAWSPR PROC
	;IN
	;DS:BX - ëèêÄâíéÇÄü ÇàÑÖéíÄÅãàñÄ

	PUSHF
	PUSHA
	PUSH	DS
	PUSH	ES
	MOV	AX,DS:[BX+8]
	MOV	DX,WORD PTR CS:[VTBL+6]
	SHR	DX,3
	PUSH	DX
	MUL	DX
	MOV	DI,DS:[BX+0AH]
	SHR	DI,3	     ;!!!!!!
	ADD	AX,DI
	LES	DI,DWORD PTR CS:[VTBL]
	ADD	DI,AX
	MOV	CX,DS:[BX+4]
	MOV	BP,DS:[BX+6]
	MOV	DL,BYTE PTR CS:[VTBL+8]
	LDS	SI,DWORD PTR DS:[BX]
	MOV	BX,DX
	MOV	DX,3CEH
	MOV	AX,205H
	OUT	DX,AX
	MOV	AX,3
	OUT	DX,AX
	POP	DX
EGAWSPR3:
	PUSH	CX
	PUSH	DX
	PUSH	DI
	PUSH	BP
	MOV	CX,BP
	LEA	BP,EGARCOLORFLAGS
	MOV	DX,3CEH
	MOV	BH,80H
EGAWSPR2:
	MOV	AL,8
	MOV	AH,BH
	OUT	DX,AX
	MOV	AL,ES:[DI]
	CALL	EGARCOLOR;IN:BP-ADRESS EGAWSPRFLAGS,BL-äéã-Çé ÅàíéÇ ñÇÖíÄ(EGA=4);OUT:AL-COLOR
	MOV	ES:[DI],AL
	ROR	BH,1
	JNC	EGAWSPR4
	INC	DI
EGAWSPR4:
	LOOP	EGAWSPR2
	POP	BP
	POP	DI
	POP	DX
	POP	CX
	ADD	DI,DX
	LOOP	EGAWSPR3
	POP	ES
	POP	DS
	POPA
	POPF
	RET
EGAWCOLOR	PROC	;AH-COLOR
	RET
EGARCOLOR   PROC
	PUSH	CX
	MOV	CL,BL
	TEST	BYTE PTR CS:[BP],1
	JNZ	EGARCOLOR1
	XOR	AH,AH
	LODSB
	XOR	BYTE PTR CS:[BP],10001B
	JMP	SHORT	EGARCOLOR2
EGARCOLOR1:
	XOR	AL,AL
	XCHG	AL,CS:[BP]
EGARCOLOR2:
	SHL	AX,CL
	OR	CS:[BP],AL
	MOV	AL,AH
	POP	CX
	RET
EGARCOLORFLAGS	DB	0
ENDP
ENDP
ENDP